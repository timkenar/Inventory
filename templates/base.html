<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <script src="https://unpkg.com/@heroicons/react@2.0.18/solid.js"></script>
    <script src="https://unpkg.com/@heroicons/react@2.0.18/outline.js"></script>
    <style>
      .popup-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 50;
      }
      .popup-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
      }
      .sidebar-collapsed {
        width: 64px;
      }
      .sidebar-expanded {
        width: 256px;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800 min-h-screen flex">
    <!-- Sidebar -->
    <aside 
      id="sidebar" 
      class="bg-gray-800 text-white p-4 shadow-lg transition-all duration-300 {% if request.session.sidebar_collapsed %}sidebar-collapsed{% else %}sidebar-expanded{% endif %}"
      hx-target="this"
      hx-swap="outerHTML"
    >
      <div class="flex items-center justify-between mb-6">
        <h2 style="font-family:serif" class="text-xl font-bold {% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Inventory App</h2>
        <button 
          hx-get="{% url 'core:toggle_sidebar' %}" 
          class="text-white hover:text-gray-300 focus:outline-none"
        >
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <nav class="space-y-2 flex-1">
        <a href="{% url 'core:dashboard' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Dashboard</span>
        </a>
        <a href="{% url 'purchases:warehouse' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 6h16v2H4V6zM4 11h16v2H4v-2zM4 16h16v2H4v-2z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Warehouse</span>
        </a>
        <a href="{% url 'purchases:purchase_sheet' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M13 7h5v2h-5V7zM3 7h5v2H3V7zm0 6h5v2H3v-2zm10 0h5v2h-5v-2z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Purchase Sheet</span>
        </a>
        <a href="{% url 'purchases:laptops' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h12v2H4V4zm0 5h12v2H4V9zm0 5h12v2H4v-2z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Laptops</span>
        </a>
        <a href="{% url 'core:reports' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 8.5h2v2H9V8.5zM9 12h2v2H9v-2zm4-3.5h2v2h-2V8.5zm0 3.5h2v2h-2v-2zM5 8.5h2v2H5V8.5zM5 12h2v2H5v-2z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Reports</span>
        </a>
        <a href="{% url 'core:settings' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200 font-medium group">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 4a1 1 0 00-2 0v12a1 1 0 102 0V4zm4 2a1 1 0 00-2 0v10a1 1 0 102 0V6zm4-1a1 1 0 00-2 0v12a1 1 0 102 0V5zm4 2a1 1 0 00-2 0v8a1 1 0 102 0V7z"/></svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block{% endif %}">Settings</span>
        </a>
      </nav>

      {% if request.user.is_authenticated %}
      <div class="mt-auto relative group">
        <button class="flex items-center w-full p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200">
          <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
          </svg>
          <span class="{% if request.session.sidebar_collapsed %}hidden{% else %}block truncate{% endif %}">{{ request.user.username }}</span>
        </button>
        <div class="absolute left-0 bottom-full mb-2 w-64 bg-white rounded-lg shadow-lg hidden group-hover:block">
          <div class="py-2">
            <span class="block px-4 py-2 text-sm text-gray-700">Email: {{ request.user.email }}</span>
            <span class="block px-4 py-2 text-sm text-gray-700">Name: {{ request.user.first_name }} {{ request.user.last_name }}</span>
            <button 
              hx-get="{% url 'core:profile_edit' %}" 
              hx-target="#profile-popup" 
              hx-swap="innerHTML"
              class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              onclick="document.getElementById('profile-popup-overlay').style.display='block'"
            >
              Edit Profile
            </button>
            <a href="{% url 'core:logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
          </div>
        </div>
      </div>
      {% endif %}
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col">
      <header class="bg-gray-800 text-white p-6 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
          <div class="text-center md:text-left">
            <h1 class="text-3xl font-bold">Welcome to Inventory Management</h1>
            <p class="text-lg italic">Streamline your inventory, sales, and purchases effortlessly.</p>
          </div>
          {% if not request.user.is_authenticated %}
          <div class="flex space-x-4">
            <a href="{% url 'core:login' %}" class="px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-500 transition-colors duration-200 font-medium">Login</a>
            <a href="{% url 'core:register' %}" class="px-6 py-3 rounded-lg bg-green-600 text-white hover:bg-green-500 transition-colors duration-200 font-medium">Sign Up Free</a>
          </div>
          {% else %}
          <a href="{% url 'core:dashboard' %}" class="px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-500 transition-colors duration-200 font-medium">Go to Dashboard</a>
          {% endif %}
        </div>
      </header>

      <!-- Profile Edit Popup -->
      <div id="profile-popup-overlay" class="popup-overlay">
        <div id="profile-popup" class="popup-content bg-white p-6 rounded-lg shadow-lg w-96">
          <!-- HTMX will load content here -->
        </div>
      </div>

      <!-- Main Content Block -->
      <main class="flex-1 p-8">
        {% block content %}{% endblock %}
      </main>

      <footer class="bg-gray-800 text-white text-center p-4 shadow-md">
        Â© 2025 Inventory Management - All rights reserved
      </footer>
    </div>

    <script>
      document.addEventListener('click', function(event) {
        const overlay = document.getElementById('profile-popup-overlay');
        const popup = document.getElementById('profile-popup');
        const profileButton = event.target.closest('.group');
        
        if (overlay.style.display === 'block' && !popup.contains(event.target) && !profileButton) {
          overlay.style.display = 'none';
        }
      });

      document.body.addEventListener('htmx:afterSwap', function(event) {
        if (event.target.id === 'profile-popup') {
          document.getElementById('profile-popup-overlay').style.display = 'block';
        }
      });
    </script>
  </body>
</html>